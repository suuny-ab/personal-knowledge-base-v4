# 项目协作协议

**项目名称**: Personal Knowledge Base System (个人知识库智能管理系统)
**开始日期**: 2026-01-16
**协作模式**: 协作开发（AI + 人工）

---

## 🎯 协作原则

### 1. 任务分解方式
- 每个大任务分解为 3-6 个小任务
- 每个小任务预计 5-30 分钟完成
- 一次只聚焦 1-2 个小任务，避免信息过载

### 2. 每个任务的协作流程

#### AI 的职责
- 提供清晰的任务目标和说明
- 展示 3 种完成方式选项（学习型/快速型/灵活型）
- 根据用户选择提供相应支持
- 创建必要的代码和配置文件
- 提供技术指导和最佳实践
- 协同用户完成任务
- 代码审查和优化建议
- 测试功能并报告问题
- 测试成功时提交代码
- 更新项目协作协议

#### 用户的职责
- 选择最适合的完成方式
- 根据指导完成任务
- 决定项目优先级和方向
- 提供反馈和需求调整

### 3. 任务完成方式选项

**A. 学习型**
- AI 详细解释技术原理和最佳实践
- 提供代码示例和注释
- 用户亲自动手编写代码
- 适合：感兴趣的技术模块、核心功能

**B. 快速型**
- AI 直接提供完整可用的代码
- 用户查看结果并进行测试
- 节省时间，快速推进项目
- 适合：不感兴趣的部分、重复性工作

**C. 灵活型**
- AI 创建核心代码框架
- 用户补充具体实现细节
- 平衡学习和效率
- 适合：中等复杂度的模块

### 4. Git 版本管理策略

#### 提交策略
- **每个子任务代码完成后进行测试，测试成功后提交代码**
- **提交信息格式**: 遵循SKILL要求

#### 同步策略
- **每个子任务完成测试后推送到远程仓库**
- **确保远程仓库始终保持最新状态**
- **避免大量未提交的代码堆积**
- **测试后提交**: 确保代码质量再提交到仓库

#### 分支策略
- **主分支 (main)**: 稳定版本
- **开发分支 (dev)**: 开发中的功能
- **功能分支 (feature/*)**: 独立功能开发
- **当前策略**: 直接在 main 分支开发，快速迭代


### 5.测试策略 
- **测试覆盖**: 完成代码后进行测试，测试成功后才能提交代码
- **灵活测试**: 根据完成的代码决定创建单元测试还是集成测试或者是进行轻量级测试
- **测试分类**:
  - 轻量级: 语法检查 + 基本验证
  - 单元测试: 核心逻辑测试
  - 集成测试: 端到端功能验证
- **工作流程**:
  ```
  完成代码 → 运行测试 → 通过测试 → 提交代码
  ```
- **测试文档位置**：`/tests` 目录下，集成测试存放在 `/tests/integration` 目录下，单元测试存放在 `/tests/unit` 目录下


---

## 📋 任务进度跟踪

### 当前任务列表
```
阶段 1: 项目基础 (任务 1) ✅ 全部完成
  - 任务 1.1: 创建项目目录结构 [✅ 完成]
  - 任务 1.2: 创建后端配置文件 [✅ 完成]
  - 任务 1.3: 创建前端配置文件 [✅ 完成]
  - 任务 1.4: 创建基础配置文件 [✅ 完成]

阶段 2: 用户认证系统 (任务 2)
  - 任务 2.1: 创建用户数据模型 [✅ 完成]
  - 任务 2.2: 实现数据库连接 [✅ 完成]
  - 测试: 添加用户模型和数据库单元测试 [✅ 完成]
  - 任务 2.3: 实现 JWT 工具类 [✅ 完成]
  - 任务 2.4: 实现认证中间件 [进行中]
  - 任务 2.5: 实现注册 API [待开始]
  - 任务 2.6: 实现登录 API [待开始]

阶段 3: AI 集成 (任务 3) [重点关注]
  - 任务 3.1: 创建 LLM 工厂类 [待开始]
  - 任务 3.2: 集成 DeepSeek [待开始]
  - 任务 3.3: 集成智谱AI GLM-4.7 [待开始]
  - 任务 3.4: 集成智谱AI embedding-3 [待开始]
  - 任务 3.5: 测试多模型切换 [待开始]

阶段 4: 向量存储 (任务 4)
  - 任务 4.1: 配置 ChromaDB [待开始]
  - 任务 4.2: 实现文档分块策略 [待开始]
  - 任务 4.3: 实现向量索引 [待开始]
  - 任务 4.4: 实现向量检索 [待开始]

阶段 5: RAG 检索 (任务 5)
  - 任务 5.1: 创建检索链 [待开始]
  - 任务 5.2: 设计 RAG PromptTemplate [待开始]
  - 任务 5.3: 实现检索 API [待开始]
  - 任务 5.4: 添加引用来源标注 [待开始]

阶段 6: 对话系统 (任务 6)
  - 任务 6.1: 配置 LangChain Memory [待开始]
  - 任务 6.2: 实现会话管理 [待开始]
  - 任务 6.3: 创建对话链 [待开始]
  - 任务 6.4: 实现对话 API [待开始]

阶段 7: GitHub 同步 (任务 7)
  - 任务 7.1: 集成 PyGithub [待开始]
  - 任务 7.2: 实现仓库绑定 [待开始]
  - 任务 7.3: 实现文件差异检测 [待开始]
  - 任务 7.4: 实现双向同步 [待开始]
  - 任务 7.5: 实现冲突解决 [待开始]

阶段 8: 前端界面 (任务 8)
  - 任务 8.1: 创建登录注册页面 [待开始]
  - 任务 8.2: 创建知识库管理页面 [待开始]
  - 任务 8.3: 创建语义检索页面 [待开始]
  - 任务 8.4: 创建 AI 对话页面 [待开始]
  - 任务 8.5: 创建知识整合页面 [待开始]
  - 任务 8.6: 创建 GitHub 同步页面 [待开始]
  - 任务 8.7: 创建可复用组件 [待开始]
  - 任务 8.8: 集成前端应用 [待开始]
```

---

## 🔍 用户关注点

### 重点关注的模块
1. **AI 集成**（最关注）
   - LangChain 使用
   - LLM 工厂模式
   - 多模型切换
   - RAG 实现

2. **全栈开发流程**（次关注）
   - 前后端通信
   - API 设计
   - 数据库集成
   - 部署流程

### 不太关注的模块
- 前端 UI 细节（可快速型完成）
- 基础配置文件（可快速型完成）
- 文档编写（可选）

---

## 📌 上下文管理策略

### 定期总结
每个阶段完成后，AI 将提供：
- 已完成任务的简要回顾
- 技术要点总结
- 下一个任务的预览
- 更新在笔记区域的阶段总结段落

### 关键决策记录
重要技术决策将记录在此文档：
1. **LangChain 版本**: 0.3.7（2024年12月最新稳定版）
2. **智谱AI embedding**: 使用 langchain-community 官方 ZhipuAIEmbeddings
3. **Pydantic 版本**: v2（LangChain 0.3 要求）
4. **向量存储**: ChromaDB（LangChain 原生支持）
5. **对话模型默认**: DeepSeek deepseek-chat（性价比）
6. **备用模型**: 智谱AI GLM-4.7（编码能力最强）

### 回滚机制
如果遇到问题：
- 使用 Git 回退到上一个稳定版本
- 在本文件记录问题和解决方案
- 重新评估技术方案

---

## 💬 沟通规范

### 用户指令格式
```
[任务ID] [选择方式]

示例：
1.1 A    # 任务 1.1，选择学习型
2.3 B    # 任务 2.3，选择快速型
3.2 C    # 任务 3.2，选择灵活型
```

### AI 响应格式
```
📋 任务 X.Y: [任务名称]
🎯 目标: [清晰描述]
⏱️ 预计时间: [X分钟]
💡 难度: [简单/中等/困难]

📝 技术要点:
- 要点 1
- 要点 2

💻 实施步骤:
1. 步骤 1
2. 步骤 2
3. ...

✅ 完成后请回复 "完成" 或描述遇到的问题
```

---

## 📊 进度可视化

### 进度条
```
阶段 1: [████████████████████] 100% ✅ (1.1-1.4)
阶段 2: [████████████░░░░░░░░░░░░░] 37.5% (2.1-2.6)
阶段 3: [░░░░░░░░░░░░░░░░] 0% (3.1-3.5) ⭐ 重点
阶段 4: [░░░░░░░░░░░░░░░░░] 0% (4.1-4.4)
阶段 5: [░░░░░░░░░░░░░░░░░] 0% (5.1-5.4)
阶段 6: [░░░░░░░░░░░░░░░░░] 0% (6.1-6.4)
阶段 7: [░░░░░░░░░░░░░░░░░] 0% (7.1-7.5)
阶段 8: [░░░░░░░░░░░░░░░░░░] 0% (8.1-8.8)
```

### 总体进度
```
总进度: [███████░░░░░░░░░░░] 21.875% (7/32 任务)
预计剩余时间: ~6.5-8.5 小时
```

---

## 🚀 快速启动指令

### 当用户返回时
用户只需说："继续" 或 "下一个任务"
AI 将：
1. 显示当前任务列表
2. 突出显示下一个待办任务
3. 提供 3 种完成方式选项

### 当遇到问题时
用户只需说："帮助" 或 "卡住了"
AI 将：
1. 提供当前任务的详细说明
2. 分析可能的问题原因
3. 提供多个解决方案

### 当需要暂停时
用户只需说："暂停" 或 "记录当前状态"
AI 将：
1. 保存当前进度到此文档
2. 总结已完成的工作
3. 列出下一步需要做的

---

## 📝 笔记区域

### 阶段总结

#### [待更新]

### 已完成的任务记录

#### 2026-01-16
**任务 1.1：创建项目目录结构** ✅ 完成
- 完成方式：学习型（用户手动创建）
- 创建的目录：
  - backend/ (含 app/, tests/)
  - frontend/ (含 pages/, components/, utils/)
  - data/ (含 users/, knowledge_bases/, chroma_db/)
- 学习要点：
  - 分层架构设计（API → Service → Database）
  - 前后端分离
  - 多用户数据隔离
  - 组件化设计

**任务 1.2：创建后端配置文件** ✅ 完成
- 完成方式：灵活型（AI 创建核心依赖，用户补充 AI 相关依赖）
- 创建的文件：
  - backend/requirements.txt（Python 依赖管理）
  - backend/.env.example（环境变量模板）
- 学习要点：
  - Python 依赖管理最佳实践
  - 环境变量安全配置
  - LangChain 0.3.7 + Pydantic v2 依赖兼容性
  - AI 服务依赖（DeepSeek、智谱AI、ChromaDB）

**任务 1.3：创建前端配置文件** ✅ 完成
- 完成方式：快速型（AI 直接提供完整代码）
- 创建的文件：
  - frontend/requirements.txt（Streamlit 依赖管理）
  - frontend/config.py（前端配置统一管理）
- 学习要点：
  - Streamlit 框架依赖配置
  - API 端点统一管理
  - UI 主题和布局配置
  - 功能参数集中配置
  - HTTP 客户端配置

**任务 1.4：创建基础配置文件** ✅ 完成
- 完成方式：学习型（用户手动创建，AI 指导）
- 创建的文件：
  - .gitignore（Git 忽略规则）
  - README.md（项目说明文档）
- Git 提交：f7f4221 - docs: 添加 .gitignore 和 README.md
- 学习要点：
  - .gitignore 的作用和常见规则
  - README.md 的标准结构
  - Conventional Commits 提交规范

**任务 2.1：创建用户数据模型** ✅ 完成
- 完成方式：快速型（AI 直接提供完整代码）
- 创建的文件：
  - backend/app/models/user.py（Pydantic v2 用户模型）
- Git 提交：2a8b53e - feat: 添加用户数据模型
- 测试文件：unit/test_models.py
- 测试状态：待测试

**任务 2.2：实现数据库连接** ✅ 完成
- 完成方式：快速型（AI 直接提供完整代码）
- 创建的文件：
  - backend/app/database/user_db.py（SQLAlchemy 2.0 异步数据库）
- Git 提交：5ede1a0 - feat: 实现用户数据库连接
- 学习要点：
  - SQLAlchemy 2.0 异步连接
  - 定义 User 表模型
  - 实现密码哈希功能（bcrypt）
  - 实现 CRUD 操作方法
  - 异步会话管理
- 测试文件：unit/test_user_db.py
- 测试状态：待测试

**任务 2.3：实现 JWT 工具类** ✅ 完成
- 完成方式：快速型（AI 直接提供完整代码）
- 创建的文件：
  - backend/app/core/security.py（JWT 令牌生成和验证）
- Git 提交：57218fb - feat: 实现 JWT 工具类
- 学习要点：
  - JWT 令牌生成和编码
  - JWT 令牌验证和解码
  - 令牌过期时间配置（24小时）
  - 密钥管理
- 测试文件：unit/test_security.py，
- 测试状态：待测试

### 遇到的问题和解决方案

#### 测试相关
- pytest 环境配置问题，导致测试无法运行
- 解决方案：创建测试文件，后续统一配置 pytest 环境后批量运行

### 技术决策变更记录

#### [待更新]

---

**最后更新**: 2026-01-16
**当前任务**: 2.4 - 实现认证中间件
**下一步**: 继续实现 FastAPI 依赖注入的认证中间件
