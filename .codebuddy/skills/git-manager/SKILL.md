---
name: git-manager
description: 当用户需要 Git 版本控制管理时使用此技能，包括提交变更、分支管理、版本回滚、远程仓库操作和项目状态跟踪。该技能提供半自动化的 Git 工作流程，具有透明的决策过程和用户确认机制。
---

# Git 管理技能

## 技能目的

提供半自动化的 Git 版本控制管理，包括透明的工作流程、清晰的提交消息和每一步的用户确认。该技能帮助用户在 AI 辅助操作下维护干净的 Git 历史，同时通过实践学习 Git 最佳实践。

## 使用时机

在以下情况使用此技能：
- 用户完成功能开发，需要提交变更
- 用户请求 Git 操作（提交、分支、合并、推送、拉取等）
- 用户需要检查项目状态或查看 Git 历史
- 用户想要回滚或比较版本
- 用户需要远程仓库管理
- 用户询问 Git 相关指导或最佳实践

不要用于：
- 与 Git 无关的简单文件读写操作
- 不需要版本控制的常规代码编辑

## 核心原则

1. **透明性**：在执行每个 Git 操作前进行说明
2. **用户确认**：对破坏性操作获取明确批准
3. **AI 优先**：使用 AI 直接分析变更并生成消息，而非依赖脚本
   - 理解业务上下文和变更意图
   - 生成高质量的提交消息
   - 解释"为什么改"而不仅仅是"改了什么"
4. **教育性**：通过操作帮助用户理解 Git 概念

## 半自动化工作流程

### 日常开发流程

1. **检查状态**
   - 运行 `git status` 查看当前状态
   - 识别已修改、新增和删除的文件
   - 向用户报告发现

2. **审查变更**
   - 使用 `git diff` 查看未暂存的变更
   - 使用 `git diff --staged` 查看已暂存的变更
   - 总结将要提交的内容

3. **分析并生成提交消息**
   - AI 直接分析代码变更（优于脚本的机械推断）
   - 理解变更的业务上下文和意图
   - 生成符合 Conventional Commits 规范的消息
   - 消息包含：类型、范围、摘要、详细描述
   - 解释"为什么改"而不仅仅是"改了什么"

4. **提议提交**
   - 向用户展示生成的提交消息
   - 解释消息的各个部分
   - 说明变更的意义和影响
   - 请求确认

5. **执行提交**
   - 运行 `git add` 添加相关文件
   - 运行 `git commit` 并附上 AI 生成的描述性消息
   - 显示提交结果

### 提交消息最佳实践

**格式：**
```
<类型>: <简短摘要>

<可选的详细描述>

<可选的脚注>
```

**类型（Type）：**
- `init`：项目初始化
- `feat`：新功能
- `fix`：Bug 修复
- `refactor`：代码重构（不改变行为）
- `docs`：仅文档变更
- `style`：代码风格变更（格式化等）
- `test`：添加或更新测试
- `chore`：维护任务

**示例：**
```
feat: 添加用户认证功能

- 实现登录/注册接口
- 集成 JWT token 验证
- 添加密码加密存储

此功能为用户管理系统的基础，后续将扩展权限控制模块。
```

```
fix: 修复搜索功能中文匹配问题

问题：中文关键词搜索时返回空结果
原因：未正确处理 UTF-8 编码
解决：统一使用 utf-8 编码处理字符串
```

### 分支管理

**创建分支：**
1. 确认分支名称和用途
2. 确保工作区干净或储存变更
3. 运行 `git checkout -b <分支名>`
4. 确认成功

**合并分支：**
1. 检查当前分支和目标分支状态
2. 运行 `git status` 确保状态干净
3. 解释合并策略（快进合并 vs. 合并提交）
4. 运行 `git merge <分支名>`
5. 如有冲突则处理
6. 适当时删除已合并的分支

### 回滚操作

**警告：**回滚操作具有破坏性，必须获取用户明确确认。

**软重置（保留变更）：**
```bash
git reset --soft HEAD~<n>
```
- 在工作区保留变更
- 将 HEAD 向后移动 n 个提交

**硬重置（丢弃变更）：**
```bash
git reset --hard HEAD~<n>
```
- 丢弃所有变更
- 将 HEAD 向后移动 n 个提交

**撤销特定提交：**
```bash
git revert <提交哈希>
```
- 创建新提交来撤销变更
- 保留历史记录

### 远程仓库操作

**连接远程仓库：**
1. 检查远程仓库是否存在：`git remote -v`
2. 添加远程仓库：`git remote add origin <URL>`
3. 验证：`git remote -v`

**推送到远程：**
1. 检查当前分支
2. 运行 `git push -u origin <分支>`（首次推送）
3. 运行 `git push`（后续推送）
4. 显示结果

**从远程拉取：**
1. 检查本地变更：`git status`
2. 如需要则储存或提交本地变更
3. 运行 `git pull`
4. 如有冲突则处理
5. 恢复储存的变更

### 项目状态跟踪

**AI 生成状态报告：**
- 分析 `git status`、`git log`、`git branch` 等输出
- 生成结构化的状态报告，包括：
  - 当前分支
  - 工作区状态（修改/新增/删除的文件）
  - 未提交的变更摘要
  - 最近的提交（最近5个）
  - 相对于远程仓库的状态（如适用）
- 提供清晰的可视化展示

**里程碑总结：**
- 列出自上次里程碑以来的提交
- 强调主要功能和变更
- 建议后续步骤

## 使用捆绑资源

### 参考目录（references/）

加载参考文档，当：
- 向用户解释 Git 概念
- 解决冲突或问题
- 故障排除 Git 问题

可用参考：
- `git_commands_reference.md`：完整的 Git 命令参考
- `best_practices.md`：Git 工作流程最佳实践
- `troubleshooting.md`：常见问题和解决方案

### 资产目录（assets/）

使用资产，当：
- 提供 Git 配置模板
- 共享示例 `.gitignore` 文件
- 创建分支策略图

可用资产：
- `templates/.gitignore`：项目特定的 gitignore 模板
- `templates/git_commit_template.txt`：提交消息模板

## 错误处理

**常见问题：**

1. **合并冲突**
   - 停止操作并通知用户
   - 解释冲突位置
   - 引导用户完成解决
   - 对已解决的文件运行 `git add`
   - 用 `git commit` 完成合并

2. **分离 HEAD（Detached HEAD）**
   - 解释发生了什么
   - 提供选项：创建分支、切换分支或重置
   - 引导恢复步骤

3. **推送被拒绝**
   - 检查远程是否有新提交
   - 建议先拉取
   - 解释强制推送的危险
   - 强制推送前获取确认

## 用户教育

执行操作时，简要解释：
- 命令做什么
- 为什么必要
- 接下来会发生什么
- 任何风险或注意事项

这有助于用户通过实践逐步理解 Git 概念。

## 安全指南

1. **绝不**在没有用户明确确认的情况下使用 `git reset --hard`
2. **绝不**在警告和确认前使用 `git push --force`
3. **始终**在破坏性操作前检查 `git status`
4. **始终**解释操作对历史的影响
5. **始终**验证命令成功并报告结果

## 沟通风格

- 使用清晰、简洁的语言
- 在相关时显示命令输出
- 适当时翻译技术术语
- 在关键操作前请求确认
- 提供决策的上下文和理由
