# Git 最佳实践

## 分支策略

### Git Flow（适合大型项目）
```
main       - 生产环境，始终保持稳定
develop    - 开发主分支，集成了所有功能
feature/*  - 功能分支，从 develop 分出，完成后合并回 develop
release/*  - 发布分支，从 develop 分出，准备发布
hotfix/*   - 热修复分支，从 main 分出，修复后合并到 main 和 develop
```

**优点：**
- 结构清晰，适合长期维护的项目
- 明确区分功能开发、发布准备和紧急修复
- 易于追踪每个版本的功能

**缺点：**
- 流程较复杂，学习曲线较陡
- 分支较多，管理成本高

### GitHub Flow（适合中小型项目）
```
main       - 生产环境，始终保持可部署
feature/*  - 功能分支，从 main 分出，完成后合并回 main
```

**优点：**
- 流程简单，易于理解和使用
- 适合持续集成和持续部署
- 分支少，管理成本低

**缺点：**
- 不支持多个并行的发布版本
- 紧急修复需要暂停功能开发

### GitLab Flow（适合有部署环境的项目）
```
main       - 生产环境
staging    - 预发布环境
develop    - 开发环境
feature/*  - 功能分支
```

**优点：**
- 支持多环境部署
- 每个环境有对应的分支
- 适合有完整测试流程的项目

## 提交规范

### Conventional Commits 规范

**格式：**
```
<类型>(<范围>): <主题>

<body>

<footer>
```

**类型（Type）：**
- `feat`：新功能
- `fix`：Bug 修复
- `docs`：文档变更
- `style`：代码格式（不影响代码运行）
- `refactor`：重构（既不是新增功能，也不是修复bug）
- `perf`：性能优化
- `test`：增加测试
- `chore`：构建过程或辅助工具的变动
- `revert`：回滚之前的提交

**示例：**
```
feat(auth): 添加用户登录功能

- 实现邮箱/密码登录
- 集成 JWT token 认证
- 添加登录表单验证

Closes #123
```

### 提交频率建议
- **频繁提交**：完成一个小功能或修复一个 bug 就提交
- **原子提交**：每个提交只做一件事
- **可回滚**：每个提交都应该是可以独立回滚的
- **测试通过**：提交前确保测试通过

## 工作区管理

### 保持工作区干净
```bash
# 提交或储存未完成的工作
git commit -m "WIP: 暂存未完成的工作"
# 或
git stash save "未完成的工作"
```

### 使用 .gitignore
忽略不需要版本控制的文件：
- 依赖目录（node_modules, venv）
- 构建产物（dist, build）
- IDE 配置（.idea, .vscode）
- 环境变量（.env）
- 临时文件（*.log, *.tmp）

### 定期清理
```bash
# 查看未跟踪文件
git clean -n

# 删除未跟踪文件
git clean -f

# 删除未跟踪文件和目录
git clean -fd
```

## 协作最佳实践

### 拉取前先拉取
```bash
# 推送前先拉取远程变更
git pull --rebase origin main
git push
```

### 解决冲突
1. 及时更新：频繁拉取远程变更
2. 小步提交：保持提交小而专注，减少冲突
3. 沟通协作：与团队成员同步进度
4. 谨慎使用：避免强制推送，除非必要

### 代码审查
- 通过 Pull Request/Merge Request 进行代码审查
- 确保代码通过所有测试
- 至少一人审查通过后才能合并

## 安全建议

### 敏感信息
- 永远不要提交密码、密钥、令牌等敏感信息
- 使用环境变量管理配置
- 使用 `.gitignore` 忽略敏感文件
- 使用 `git-secrets` 等工具检测敏感信息

### 权限管理
- 使用受保护分支（Protected Branches）
- 要求代码审查（Code Review）
- 要求状态检查通过（CI/CD）
- 限制强制推送

### 备份
- 定期推送到远程仓库
- 使用多个远程仓库备份
- 定期打包整个仓库

## 性能优化

### 仓库维护
```bash
# 垃圾回收
git gc

# 清理引用
git prune

# 检查仓库完整性
git fsck
```

### 大文件处理
- 使用 Git LFS 管理大文件
- 避免提交二进制文件
- 拆分大型历史仓库

## 常见陷阱

### 不要在主分支直接工作
- 始终在功能分支工作
- 通过 Pull Request 合并到主分支
- 保持主分支始终稳定

### 不要提交调试代码
- 删除或注释掉调试语句
- 不要提交 console.log、debugger 等
- 使用专业的日志工具

### 不要使用强制推送
- 除非绝对必要，避免使用 `git push --force`
- 可能会覆盖其他人的工作
- 使用 `git push --force-with-lease` 更安全

### 不要提交生成的文件
- 使用 `.gitignore` 忽略
- 包括编译产物、缓存文件、临时文件
- 可以通过脚本重新生成的文件不应提交

## 团队规范建议

### 统一分支命名
```
feature/功能描述
bugfix/问题描述
hotfix/紧急问题描述
release/版本号
```

### 统一提交消息
- 制定团队提交消息规范
- 使用 Commitizen 等工具辅助
- 定期审查提交历史质量

### 定期同步
- 每日站会同步进度
- 定期代码审查
- 技术分享会议
